<div>
  <%= form_for @place do |f| %>
    <fieldset class="form-group">
      <%= f.label :title %>
      <%= f.text_field :title, class: "form-control" %>
    </fieldset>

    <fieldset class="form-group">
      <%= f.label :user_id %>
      <%= f.text_field :user_id, class: "form-control" %>
    </fieldset>

    <fieldset class="form-group">
      <%= f.label :address, 'Address' %>
      <%= f.text_field :address, class: "form-control" %>
    </fieldset>

    <fieldset class="form-group">
      <%= f.label :address, 'Address' %>
      <%= f.text_field :address, class: "form-control" %>
      <small class="text-muted">You can also enter IP. Your IP is <%= request.ip %></small>
    </fieldset>

    <div class="form-group row">
      <div class="col-sm-1">
        <%= f.label :latitude %>
      </div>

      <div class="col-sm-3">
        <%= f.text_field :latitude, class: "form-control" %>
      </div>

      <div class="col-sm-1">
        <%= f.label :longitude %>
      </div>

      <div class="col-sm-3">
        <%= f.text_field :longitude, class: "form-control" %>
      </div>

      <div class="col-sm-4">
        <a href="#" id="find-on-map" class="btn btn-info btn-sm">Find on the map</a>
      </div>

    <%= f.submit 'Add!', class: 'btn btn-primary' %>
  <% end %>
</div>

<div class="#map-container">
  <div class="card-block">
    <div id="map"></div>
  </div>
</div>
<script>
  var lat_field, lng_field, markersArray, placeMarkerAndPanTo, updateFields;
  markersArray = [];
  lat_field = $('#place_latitude');
  lng_field = $('#place_longitude');
  function initMap() {
    var map;
    if ($('#map').size() > 0) {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {
          lat: -34.397,
          lng: 150.644
        },
        mapTypeId: 'satellite',
        zoom: 14
      });
      map.addListener('click', function(e) {
        placeMarkerAndPanTo(e.latLng, map);
        return updateFields(e.latLng);
      });
      return $('#find-on-map').click(function(e) {
        e.preventDefault();
        return placeMarkerAndPanTo({
          lat: parseInt(lat_field.val(), 10),
          lng: parseInt(lng_field.val(), 10)
        }, map);
      });
    }
  };
  placeMarkerAndPanTo = function(latLng, map) {
    var marker;
    // while (markersArray.length) {
    //   markersArray.pop().setMap(null);
    // }
    marker = new google.maps.Marker({
      position: latLng,
      map: map,

      draggable: true,
      // animation: google.maps.Animation.DROP, // add animation when display marker
      // position: {lat: 59.327, lng: 18.067}
    });

    marker.addListener('drag', function(e){
      return updateFields(e.latLng);
    });

    map.panTo(latLng);
    return markersArray.push(marker);
  };

  // google.maps.event.addListener(Marker, "dragend", function(event) { 
  //   var lat = event.latLng.lat(); 
  //   var lng = event.latLng.lng(); 
  // });


  updateFields = function(latLng) {
    lat_field.val(latLng.lat());
    return lng_field.val(latLng.lng());
  };

  test = function() {
    console.log('test');
  };

  google.maps.event.addDomListener(window, 'load', initMap);
</script>